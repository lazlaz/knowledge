# Redis 实现分布式锁

##1、加锁
加锁实际上就是在redis中，给Key键设置一个值，为避免死锁，并给定一个过期时间。

`SET lock_key random_value NX PX 5000`

值得注意的是：

random_value 是客户端生成的唯一的字符串。 

NX 代表只在键不存在时，才对键进行设置操作。 

PX 5000 设置键的过期时间为5000毫秒。 


这样，如果上面的命令执行成功，则证明客户端获取到了锁。

##2、解锁
解锁的过程就是将Key键删除。但也不能乱删，不能说客户端1的请求将客户端2的锁给删除掉。这时候random_value的作用就体现出来。


为了保证解锁操作的原子性，我们用LUA脚本完成这一操作。先判断当前锁的字符串是否与传入的值相等，是的话就删除Key，解锁成功。
